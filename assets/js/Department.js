(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{716:function(e,t,a){var i=a(717);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(6).default)("3ce2f8ac",i,!1,{})},717:function(e,t,a){(e.exports=a(4)()).push([e.i,"\n.zmiti-department-main-ui[data-v-20901aa2]{height:98%;padding:10px 10px 0 10px;display:flex;display:-webkit-flex;flex-flow:row\n}\n.zmiti-department-main-ui .zmiti-department-left[data-v-20901aa2]{padding:10px;width:250px;background:#fff;overflow:auto;border-right:1px solid #ccc\n}\n.zmiti-department-main-ui .zmiti-department-left .zmiti-company[data-v-20901aa2]{display:flex;display:-webkit-flex;flex-flow:row;justify-content:space-between;font-size:16px;height:45px;line-height:45px;border-bottom:1px solid #ccc\n}\n.zmiti-department-main-ui .zmiti-department-left .zmiti-company div[data-v-20901aa2]:first-child{flex:1;font-size:16px;margin-right:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer\n}\n.zmiti-department-main-ui .zmiti-department-left .active[data-v-20901aa2]{color:#00c1de\n}\n.zmiti-department-main-ui .zmiti-department-left .zmiti-department-list[data-v-20901aa2]{margin-top:10px\n}\n.zmiti-department-main-ui .zmiti-department-left .zmiti-department-list .department-item[data-v-20901aa2]{display:flex;display:-webkit-flex;flex-flow:row;justify-content:space-between;font-size:14px;height:30px;line-height:30px\n}\n.zmiti-department-main-ui .zmiti-department-left .zmiti-department-list .department-item div[data-v-20901aa2]:first-child{flex:1;font-size:16px;margin-right:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 5px;cursor:pointer\n}\n.zmiti-department-main-ui .zmiti-department-right[data-v-20901aa2]{flex:1;background:#fff;overflow:auto;padding:10px\n}\n.zmiti-department-main-ui .zmiti-department-right header[data-v-20901aa2]{font-size:16px;width:100%;display:flex;display:-webkit-flex;flex-flow:row;justify-content:space-between;height:45px;line-height:45px;border-bottom:1px solid #eee\n}\n.zmiti-department-main-ui .zmiti-department-right header span[data-v-20901aa2]{margin:0 0px;text-align:center;text-indent:-.1em;width:50px;cursor:pointer;display:inline-block\n}\n.zmiti-department-main-ui .zmiti-department-right header span i[data-v-20901aa2]{width:12px;font-size:24px\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-list-where[data-v-20901aa2]{font-size:14px;width:98%;margin:10px auto;display:flex;display:-webkit-flex;flex-flow:row\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-list-where .ivu-input-wrapper[data-v-20901aa2]{width:200px;margin-right:10px\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-scroll[data-v-20901aa2]{overflow:auto\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-submit-main[data-v-20901aa2]{flex:5;-webkit-flex:5;width:100%\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-submit-main>div[data-v-20901aa2]{-webkit-transition:.3s;transition:.3s\n}\n.zmiti-department-main-ui .zmiti-department-right .zmiti-submit-main .zmiti-submit-table[data-v-20901aa2]{width:98%;margin:0 auto\n}\n.zmiti-add-form[data-v-20901aa2]{width:500px;overflow:auto;position:absolute !important;top:0;right:0;z-index:100;height:100%;box-shadow:0 0 0 1px #ccc;box-sizing:border-box;background:#f9f9f9\n}\n.zmiti-add-form .zmiti-add-form-C[data-v-20901aa2]{margin:10px auto 2px;width:90%\n}\n.zmiti-add-form .zmiti-add-form-item[data-v-20901aa2]{line-height:50px;height:50px\n}\n.zmiti-add-form .zmiti-add-form-item.zmiti-add-btns[data-v-20901aa2]{text-align:center;position:relative;z-index:10\n}\n.zmiti-add-form .zmiti-add-form-item.zmiti-add-btns button[data-v-20901aa2]{margin:0 20px;padding:2px 20px\n}\n.zmiti-add-form .zmiti-add-form-item input[data-v-20901aa2]{padding-left:6px;height:32px;width:70%;border:1px solid #d8d8d8;outline:none\n}\n",""])},718:function(e,t,a){var i=a(719);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(6).default)("8d9c1416",i,!1,{})},719:function(e,t,a){(e.exports=a(4)()).push([e.i,"\n.ivu-tree ul{font-size:14px\n}\n",""])},741:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a(2),r=a(10),s=a(9);let{departmentAction:d,userActions:o,formatDate:m}=n.a,l=n.a.getCurrentCompanyId();var p={data:()=>({companyname:l.companyname,visiable:!1,departmentVisiable:!1,departmentData:[],selectDepartment:[],saveDisabled:!1,userLoading:!1,userData:[],userSelectList:[],loadingModal:!0,userCondition:{page_index:0,page_size:10},userTotal:0,imgs:window.imgs,showDetailPage:-1,curNode:{},dataSource:[],total:0,loading:!1,viewH:window.innerHeight,formObj:{departmentname:"",departmentid:void 0},ruleValidate:{departmentname:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},selectList:[],condition:{page_index:0,page_size:10},columns:[{title:"姓名",key:"realname",align:"center",width:80},{title:"职务",width:100,key:"realname",align:"center"},{title:"部门",key:"departments",align:"center",render:(e,t)=>{console.log(t.row);let a=[];return t.row.departments.forEach(e=>{a.push(e.departmentname)}),e("div",{},a.join(","))}},{title:"办公电话",key:"jobphonenum",align:"center"},{title:"手机",key:"usermobile",align:"center"},{title:"邮箱",key:"useremail",align:"center"}]}),components:{ZmitiMask:r.a,ZmitiTable:s.a},mounted(){this.getDepartmentData()},methods:{getSelection(e){console.log(e),this.selectList=e},getUserSelection(e){this.userSelectList=e},departmentClick(e,t){this.$refs.mainTable.selectAll(!1),1==e&&this.curNode.departmentid!=t.departmentid?(this.curNode=t,this.condition.page_index=0,this.getDepartmentUserData(),console.log(t)):0==e&&(this.curNode=l,this.condition.page_index=0,this.getDepartmentUserData())},departmentChange(e,t){this.$refs.mainTable.selectAll(!1),this.curNode.departmentid==t.departmentid?t.selected=!0:($(".company-hone").removeClass("ivu-tree-title-selected"),this.curNode=t,this.getDepartmentUserData(),console.log(t))},userDepartmentChange(e,t){console.log(e,t);var a=this;1==t.checked?n.a.ajax({remark:"addDepartmentUser",data:{action:d.addDepartmentUser.action,info:{companyid:l.companyid,departmentid:t.departmentid,userids:this.selectList[0].userid+""}},success(i){0===i.getret?a.selectDepartment=e:(t.checked=!1,a.$Message.error("添加用户部门失败"))}}):n.a.ajax({remark:"delDepartmentUser",data:{action:d.delDepartmentUser.action,condition:{companyid:l.companyid,departmentid:t.departmentid,userids:this.selectList[0].userid+""}},success(i){0===i.getret?a.selectDepartment=e:(t.checked=!0,a.$Message.error("删除用户部门失败"))}})},showDepartment(e,t){i.default.obserable.trigger({type:"toggleMask",data:!0}),1==e&&(this.formObj={departmentid:t.departmentid,departmentname:t.title})},showDepartmentModal(){if(1==this.selectList.length){this.selectDepartment=[];let e=[];this.selectList[0].departments.forEach(t=>{e.push(t.departmentid)}),this.departmentData.forEach(t=>{t.checked=!1,e.includes(t.departmentid)&&(t.checked=!0,this.selectDepartment.push(t))}),this.departmentVisiable=!0}else this.$Message.warning("请选择一个用户设置部门")},closeDepartmentModal(){this.getDepartmentUserData()},delDepartment(e){e.departmentid?this.$Modal.confirm({title:"确认删除",content:'<p>确认要删除<span style="color:red;"> '+e.title+" </span>吗？</p>",onOk:()=>{var t=this;n.a.ajax({remark:"delDepartment",data:{action:d.delDepartment.action,info:{companyid:l.companyid,departmentids:e.departmentid.toString()}},success(e){t.$Message[0===e.getret?"success":"error"](e.msg||e.getmsg),0===e.getret&&t.getDepartmentData()}})},onCancel:()=>{}}):this.$Message.warning("请选中要删除的部门")},getAllUser(){var e=this;this.userLoading=!0;let t=Object.assign({companyid:l.companyid},this.userCondition);e.userData=[],e.userTotal=0,n.a.ajax({remark:"getCompanyUserList",data:{action:d.getCompanyUserList.action,condition:t},error(){e.userLoading=!1},success(t){e.userLoading=!1,0===t.getret&&(e.userTotal=t.total,e.userData=t.list)}})},chooseUser(){this.visiable=!0,this.userSelectList=[],this.$refs.userTable.selectAll(!1),this.userData.length<=0&&this.getAllUser()},addUser(){if(this.userSelectList.length<=0)return this.loadingModal=!1,void this.$Message.warning("请选中要添加的用户");var e=this;let t=[];this.userSelectList.forEach(e=>{if(console.log(e.departments),e.departments.length>0){let a=!0;e.departments.forEach(t=>{e.departmentid==this.curNode.departmentid&&(a=!1)}),a&&t.push(e.userid)}else t.push(e.userid)}),n.a.ajax({remark:"addDepartmentUser",data:{action:d.addDepartmentUser.action,info:{companyid:l.companyid,departmentid:this.curNode.departmentid,userids:t.join(",")}},success(t){e.loadingModal=!1,e.$Message[0===t.getret?"success":"error"](t.msg||t.getmsg),0===t.getret&&(e.getDepartmentUserData(),e.visiable=!1)}})},delUser(){if(this.selectList.length>0){let t=[];this.selectList.forEach(e=>{t.push(e.userid)});var e=this;n.a.ajax({remark:"delDepartmentUser",data:{action:d.delDepartmentUser.action,condition:{companyid:l.companyid,departmentid:this.curNode.departmentid,userids:t.join(",")}},success(t){e.$Message[0===t.getret?"success":"error"](t.msg||t.getmsg),0===t.getret&&e.getDepartmentUserData()}})}else this.$Message.warning("请选中要删除的用户")},userChange(e){this.userCondition.page_index=e-1,this.getAllUser()},change(e){this.condition.page_index=e-1,this.getDepartmentUserData()},closeMaskPage(){this.$refs.ruleForm.resetFields(),i.default.obserable.trigger({type:"toggleMask",data:!1})},getDepartmentData(){let e=this,t={companyid:l.companyid,fatherid:0,status:1,page_index:0,page_size:1e3};n.a.ajax({remark:"getDepartmentList",data:{action:d.getDepartmentList.action,condition:t},success(t){if(0===t.getret){let a=[],i=void 0,n=[];t.list.forEach((e,t)=>{let r=0==t,s={title:e.departmentname,departmentname:e.departmentname,departmentid:e.departmentid,fatherid:e.fatherid,status:e.status,selected:r},d={title:e.departmentname,departmentname:e.departmentname,departmentid:e.departmentid,fatherid:e.fatherid,status:e.status,checked:!1};a.push(s),n.push(d),r&&(i=s)}),e.departmentData=n,e.curNode=i,e.getDepartmentUserData()}}})},getDepartmentUserData(){let e=this,t=this.curNode.departmentid?d.getDepartmentUserList.action:d.getCompanyUserList.action,a=Object.assign({companyid:l.companyid,departmentid:this.curNode.departmentid},this.condition);e.dataSource=[],e.total=0,e.loading=!0,n.a.ajax({remark:this.curNode.departmentid?"getDepartmentUserList":"getCompanyUserList",data:{action:t,condition:a},success(t){e.loading=!1,0===t.getret?(e.dataSource=t.list,e.total=t.total):e.$Message.error(t.msg||t.getmsg)}})},adminAction(e){console.log(this.formObj),this.$refs[e].validate(e=>{if(e){let e=this.formObj.departmentid?d.editDepartment.action:d.addDepartment.action,t=Object.assign({companyid:l.companyid,fatherid:0,status:1},this.formObj),a=this;a.saveDisabled=!0,n.a.ajax({remark:this.formObj.departmentid?"editDepartment":"addDepartment",data:{action:e,info:t},error(e){a.saveDisabled=!1},success(e){a.saveDisabled=!1,a.$Message[0===e.getret?"success":"error"](e.msg||e.getmsg),0===e.getret&&(a.closeMaskPage(),a.getDepartmentData())}})}})}}},c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"zmiti-department-main-ui lt-full"},[a("div",{staticClass:"zmiti-department-left"},[a("div",{staticClass:"zmiti-company"},[a("div",{class:{active:e.curNode.companyname==e.companyname},on:{click:function(t){return e.departmentClick(0)}}},[e._v(e._s(e.companyname))]),e._v(" "),a("div",[a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.showDepartment(0)}}},[e._v("新增部门")])],1)]),e._v(" "),a("div",{staticClass:"zmiti-department-list"},[a("ul",e._l(e.departmentData,(function(t){return a("li",{key:t.departmentid,staticClass:"department-item"},[a("div",{class:{active:e.curNode.departmentid==t.departmentid},on:{click:function(a){return e.departmentClick(1,t)}}},[e._v(e._s(t.departmentname))]),e._v(" "),a("div",[a("Button",{attrs:{type:"dashed",size:"small"},on:{click:function(a){return e.showDepartment(1,t)}}},[e._v("修改")]),e._v(" "),a("Button",{attrs:{type:"dashed",size:"small"},on:{click:function(a){return e.delDepartment(t)}}},[e._v("删除")])],1)])})),0)])]),e._v(" "),a("div",{staticClass:"zmiti-department-right"},[a("header",{staticClass:"zmiti-department-header"},[a("div",[e._v(e._s(e.curNode.title||e.curNode.companyname))])]),e._v(" "),a("div",{staticClass:"zmiti-department-main zmiti-scroll",style:{height:e.viewH-140+"px"}},[a("section",{staticClass:"zmiti-list-where"}),e._v(" "),a("ZmitiTable",{ref:"mainTable",attrs:{loading:e.loading,dataSource:e.dataSource,columns:e.columns,change:e.change,current:e.condition.page_index+1,"page-size":e.condition.page_size,total:e.total},on:{getSelection:e.getSelection},scopedSlots:e._u([{key:"table-btns",fn:function(){return[e.curNode.departmentid?a("Button",{on:{click:e.chooseUser}},[e._v("新增")]):e._e(),e._v(" "),a("Button",{on:{click:e.showDepartmentModal}},[e._v("设置部门")]),e._v(" "),e.curNode.departmentid?a("Button",{on:{click:e.delUser}},[e._v("删除")]):e._e()]},proxy:!0}])})],1)])]),e._v(" "),a("ZmitiMask",{on:{closeMaskPage:e.closeMaskPage},model:{value:e.showDetailPage,callback:function(t){e.showDetailPage=t},expression:"showDetailPage"}},[a("div",{attrs:{slot:"mask-content"},slot:"mask-content"},[a("transition",{attrs:{name:"detail"}},[a("section",{staticClass:"zmiti-add-form zmiti-scroll"},[a("header",{staticClass:"zmiti-add-header"},[a("img",{attrs:{src:e.imgs.back,alt:""},on:{click:e.closeMaskPage}}),e._v(" "),a("span",[e._v("部门信息")])]),e._v(" "),a("div",{staticClass:"zmiti-add-form-item zmiti-add-btns"},[a("Form",{ref:"ruleForm",staticClass:"zmiti-add-form-C",attrs:{model:e.formObj,rules:e.ruleValidate,"label-width":90}},[a("FormItem",{attrs:{label:"",prop:"departmentid"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.formObj.departmentid,expression:"formObj.departmentid"}],attrs:{type:"hidden"},domProps:{value:e.formObj.departmentid},on:{input:function(t){t.target.composing||e.$set(e.formObj,"departmentid",t.target.value)}}})]),e._v(" "),a("FormItem",{attrs:{label:"部门名称：",prop:"departmentname"}},[a("Input",{attrs:{placeholder:"部门名称"},model:{value:e.formObj.departmentname,callback:function(t){e.$set(e.formObj,"departmentname",t)},expression:"formObj.departmentname"}})],1)],1),e._v(" "),a("Button",{attrs:{size:"large",disabled:e.saveDisabled,type:"primary"},on:{click:function(t){return e.adminAction("ruleForm")}}},[e._v("保存")])],1)])])],1)]),e._v(" "),a("Modal",{attrs:{title:"选择用户",width:"800",loading:e.loadingModal,"mask-closable":!1},on:{"on-ok":e.addUser},model:{value:e.visiable,callback:function(t){e.visiable=t},expression:"visiable"}},[a("div",[a("ZmitiTable",{ref:"userTable",attrs:{height:300,loading:e.userLoading,dataSource:e.userData,columns:e.columns,change:e.userChange,"page-size":e.userCondition.page_size,total:e.userTotal},on:{getSelection:e.getUserSelection}})],1)]),e._v(" "),a("Modal",{attrs:{title:"设置部门",width:"550","mask-closable":!1,"footer-hide":!0},on:{"on-cancel":e.closeDepartmentModal},model:{value:e.departmentVisiable,callback:function(t){e.departmentVisiable=t},expression:"departmentVisiable"}},[a("div",{staticStyle:{border:"1px solid #ccc",display:"flex"}},[a("div",{staticStyle:{"border-right":"1px solid #ccc",padding:"10px 10px 10px 0",flex:"1",height:"400px",overflow:"auto"}},[a("Tree",{attrs:{data:e.departmentData,"show-checkbox":"",multiple:!0,"check-strictly":!0,"check-directly":!0},on:{"on-check-change":e.userDepartmentChange}})],1),e._v(" "),a("div",{staticStyle:{flex:"1"}},[a("div",{staticStyle:{padding:"10px",height:"40px","border-bottom":"1px solid #ccc","font-size":"15px"}},[e._v("用户所在部门")]),e._v(" "),a("ul",{staticStyle:{padding:"10px","font-size":"14px"}},e._l(e.selectDepartment,(function(t){return a("li",{key:t.departmentid+"user",staticStyle:{"line-height":"30px"}},[e._v("\n            "+e._s(t.departmentname)+"\n          ")])})),0)])])])],1)};c._withStripped=!0;var u=a(3),g=!1;var h=function(e){g||(a(716),a(718))},f=Object(u.a)(p,c,[],!1,h,"data-v-20901aa2",null);f.options.__file="components\\company\\department\\index.vue";t.default=f.exports}}]);